---
title: 百度前端训练营2021大作业
date: 2021-07-21 11:54:47
tags:
- HTML
- CSS
- JavaScript
- 移动端
- 作业
---
最近参加了百度前端训练营（据说有实习机会和校招通道，很心动），最终有两个大作业四个版本，这边篇章就是其中一个关于餐厅游戏项目的实现总结。
<!-- more -->
## 项目相关
### 项目地址
[gitee链接](https://gitee.com/PangPangDeXiong/web-mooc_restaurant)

### 项目背景
[百度前端训练营](https://mp.weixin.qq.com/s/lIQ2WH6Zvvr_b4VpRFTdqg)的[餐厅作业（项目的需求在链接里）](https://github.com/webmooc/webmooc-practice/blob/master/practice_chs/restaurant.md)。

### 项目愿景和价值
- 项目为作业项目，并且要求不依赖框架完成任务，我已经很久没有写过纯JavaScript的项目了，所以也是尝试完成项目也是一个成长吧。
- 在参加训练营的过程中发现有些同学是刚学习前端的同学，还没有能力完成该作业，所以将我的实现过程分享给他们或许是最大的价值。

### 项目的阶段和排期
刚开始看见这个大作业的时候，打算先完整的作出设计，拆分任务然后才开始写代码。但是等我有时间写项目的时候预计可以写代码的时间已经不够4天，所以在做工期预测的时候知识将项目拆解功能拆解成了几个大类，疑难点提炼出来，将这些做了一个时间的整体预估，所以具体的排期这里就不展示了。
项目的阶段，我觉得理应分为四个阶段吧：
1. 完成页面样式的样式（HTML，CSS部分）
2. 完成拆解的各个组件
3. 组装各个组件（完成组件之间的逻辑交互）
4. 自测

而实际因为没有细分任务的原因将第二第三阶段柔和在一起了，提交作业马上截止的时候才完成代码，所以也没有自测（所以代码中可能有一些流程上的bug）。

### 分析要求
#### 要求项
1. 兼容性满足PC Chrome下的移动调试窗口 + 手机自带浏览器，不需要兼容微信，UC等第三方浏览场景；
2. 代码风格优雅，代码结构合理，技术设计恰到好处；
3. 框架使用方面，建议不使用框架实现一遍，然后再使用框架实现一遍；
4. 只能附件中提供的图片资源，其他样式均使用 CSS 实现；如果有额外自己添加的需求场景，可以自行按需求增加图片资源；
5. 提供的原始图片资源体积较大，根据实际需要进行性能优化所需要的压缩。

#### 分析
1. 在PC Chrome下开发，并且体现移动端调试的能力；
2. 代码有实现在一定的规则下完成，有一定的可读性，不要过渡的设计框架代码，比如自己实现个虚拟DOM，那可能有点过渡设计；
3. 视频中老师说没有必要用框架实现一遍，所以只需要用最原始的方法（HTML, CSS, JavaScript）实现一遍即可；
4. 项目中需要的类似图标却没有给的图片资源有三个（添加厨师的白色头像，添加厨师的加号，解聘厨师的叉）；
5. 将图片压缩一下（这个我没做，因为我觉得图片的优化不止压缩这么简单，关键是没时间了）。

### 分析项目中遇到的疑惑
在分析需求的过程中有发现了很多疑惑，比如：
- 周数在野蛮生长的情况下数字位数超过能显示的宽度怎么办；
- 要不要保证餐厅的最大收益，就是在安排厨师做菜的时候要不要设计个算法，保证餐厅的最大收入（感觉像是动态规划），还是上先点的菜（我的实现是后者）;
- 当金钱不够的时候不能解聘厨师，那每周计算厨师工资的时候钱不够的话是不是就游戏结束了；
- 菜单的钱能不能有小数；
- 等等。

在正常的工作环境中，遇到这些疑惑，可能要拉着产品一起去会议室打架，而此次作业我的处理方式是综合自己对于产品的理解和工期去处理问题，并没有和老师有进一步的交流，下面的内容可能对于一些疑惑有描述。

### 对于本次实现代码过程中的不满
> 每次写完项目都会有一些不满来成为下次项目的开始，当然这个项目也不例外。
> -Xiangmiao Yue
1. 很多公用UI组件没有抽象出来（只抽象了Modal, Toast），导致很多样板代码，比如进度条的组件；
2. 为了保证JavaScript和CSS的解偶合，保证了绝大多数的样式操作都是操作节点的类名，导致类名散落在JavaScript代码的各个角落，考虑是不是能把类名写在JavaScript代码的某一个地方，做成一个字典；
3. 很多JavaScript代码没有封装成工具函数，比如类名的添加要写很长的代码（$dom.classList.add）,这样的代码在DOM的各个地方都有用到；
4. 没有做按钮没有做避免快速重复的点击；
5. 没有限制业务数据的数据流，比如我们都知道React的数据流是自顶向下的，只能在顶层去操作数据，这是个很好的设计，但是在这个项目中却没有体现，导致我在发现一个bug的时候，去排查bug都很蒙圈；
6. 很多文字相关的内容并没有单独的拿出来，而是偶合到了JavaScript中。

## 前端相关
### 架构相关
#### 架构图
![架构图](/images/jiagoutu1.png)
说明：其中逻辑层表示JavaScript代码的模块，表现层表示CSS代码模块。
#### 逻辑层各模块职能
- UI组件：将页面中通用的UI抽象出来，比如弹窗，这里其实抽象出至少10个组件的，但是由于开发工期比较短，所以就抽象了两个：
  - Modal(/js/index.js): 对话框；
  - Toast(/js/index.js): 提示框。
- CONFIG(/js/index.js)：项目的配置文件，用来配置一些，比如初始化金钱数量之类的可配置项；
- Utils(/js/index.js)：通用的函数；
- 逻辑组件(/js/index.js)：业务相关的抽象类；
  - Cook(/js/index.js)：厨师；
  - Customer(/js/index.js)：顾客；
  - BOSS(/js/index.js)：你；
  - App(/js/index.js)：餐厅。 

### 技术相关
#### 技术选型
##### flex+rem布局
flex+rem是移动端比较常用的布局方案了,写起来比较方便，对于手机端兼容也比较好。
其中为了使用rem布局，引入了flexible.js处理不同手机下跟元素字体大小的问题，而rem单位的计算借助于vscode的cssrem插件。具体的细节可以在网上搜搜相关的文章，有很多。
##### 面向对象编程
写个游戏你如果不抽象几个类，那就挺抽象的。
这里提一点就是，这个项目采用了组合类的办法来维护类之间的通信。
类似下面代码这样。
```JavaScript
class App {
  constructor() {
    this.boss = new BOSS(this);
  }
}
class BOSS {
  constructor(app) {
    this.app = app;
  }

  doSomething() {
    new Cook(this.app);
    new Customer(this.app);
  }
}
class Cook {
  constructor(app) {
    this.app = app;
  }
}
class Customer {
  constructor(app) {
    this.app = app;
  }
}
```
这就保证所有的类里面都能获取到BOSS和App的实例，来实现类之间的通信。
##### 定时器选择
先说明这里是通过**requestAnimationFrame**实现的定时装置。
可能提到定时器的选择，很多人会选择**setTimeout**或**setInterval**,但是我们知道，这两个api并不是在你预期的时间执行代码（如果主线程任务被占用的情况下），所以很难去设定这个间隔的值，所以我们这里使用**requestAnimationFrame**不断的轮询来实现定时器，虽然**requestAnimationFrame**多用于动画。
#### 逻辑实现
具体的逻辑实现，看代码就好了。而切每个类中的方法处理我觉得也不是很优雅。
需要注意的是，在每个类中都实现了**bindDOM**和**bindEvents**方法，用来获取DOM节点，和绑定事件，统一处理的目的是为了解偶。
有些小伙伴可能已经发现了还有一些类中有**bindDec**方法，这个方法用来设置装饰器。其实很多地方都不应该用装饰器模式解决问题，而最好用发布订阅，比如厨师做完菜之后，会有很多人关注这个菜的的状态，我觉得理想的设计就是这些人订阅这个菜的状态，这就是这个项目中数据流设计不好的地方，也是我觉得不优雅的主要原因。
#### 进度条的优化
先来看下进度条的核心代码
```CSS
@keyframes doing {
  0% {  
      transform: translateX(-50%) scaleX(0);
  }
  to {
      transform: translateX(0) scaleX(1);
  }
}
.running {    
  animation-play-state: running;
}
.paused {    
  animation-play-state: paused;
}
.xxxx {
  will-change: transform;
  animation-timing-function: linear;
  animation-name: doing;
}
```
曾几何时我在写进度条的时候也是直接改width，但是前两天看了一篇关于进度条的文章，很有收获，这里分享一下。
[《我优化了进度条，页面性能竟提高了70%》](https://mp.weixin.qq.com/s/2nk4AMvmwPWsPL1ByAs65Q)

## 规范相关
### HTML相关
1. HTML属性给CSS用的以中划(-)线分割,给JavaScript用的用下划线(_)分割；
2. JavaScript生成的DOM要在HTML中以注释的形式占位置，注释以DOM开头。
### CSS相关
1. 书写顺序
  1.1 位置（position,z-index,display等）-> 大小（width,height,padding,margin） -> 文字 -> 背景边框 -> 其他CSS3属性，因为可能有兼容问题所以放在最后；
  1.2 和上下左右相关的按上 -> 右 -> 下 -> 左的顺序。
2. 和资源相关的放在一起定义成单独的类名，比如所有的背景图片。
### JavaScript相关
1. 配置常量用大写加下划线命名，其他变量用驼峰命名，DOM节点变量以$开头;
2. 所有的类属性的初始化都要在一起实现，不能随便在方法里出现未初始化的属性；
3. 不要在类外部直接访问类属性，而是通过getter setter方法去操作。

## 总结
先说说成长吧，自打学前端以来，很少写纯原生JavaScript的项目，没有设计过这样的程序，所以在实现的过程中发现了很多可以精进的地方，在上面有提到过。还有很短的时间（4天）完成一个项目，中间还连续写了将近40个小时代码，没睡觉，这也算是一种经历上的收获吧。
再说说遗憾，可能就是后期为了赶工熬夜写代码，最终导致部分代码的实现比较草率，还有一些考虑的点没有写，毕竟刚开始看到这个需求的时候我满脑子都是一个问题，如果玩这个游戏的人退出了游戏，那下次他再进来的时候如何继续之前的进度。
还有一点遗憾可能就是这篇文章文字占比太大了，很难读，或者没有读过我的代码很难在文章上有所收获。
最后记录一下被我揉烂的四张需求的纸吧，还是挺值得纪念的。
![架构图](/images/xuqiu1.jpeg)
![架构图](/images/xuqiu2.jpeg)
![架构图](/images/xuqiu3.jpeg)
